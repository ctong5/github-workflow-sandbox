name: Enforce single-commit PRs into develop (from feature/*)
on:
  pull_request:
    branches: [ develop ]
permissions:
  contents: read
  pull-requests: read
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Enforce single commit for feature/* PRs
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
          HEAD_REF: ${{ github.head_ref }}
        run: |
          if [[ "$HEAD_REF" =~ ^feature/ ]]; then
            COMMITS=$(gh pr view "$PR_NUMBER" --json commits --jq '.commits.totalCount')
            if [ "$COMMITS" -gt 1 ]; then
              echo "::error::Ticket PRs into develop must be a single commit (found $COMMITS)."
              exit 1
            fi
          fi
